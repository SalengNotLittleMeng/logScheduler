(function(i,s){typeof exports=="object"&&typeof module<"u"?module.exports=s():typeof define=="function"&&define.amd?define(s):(i=typeof globalThis<"u"?globalThis:i||self,i.logScheduler=s())})(this,function(){"use strict";var b=Object.defineProperty;var w=(i,s,l)=>s in i?b(i,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[s]=l;var o=(i,s,l)=>(w(i,typeof s!="symbol"?s+"":s,l),l);const i=Image;let s=!1;function l(n){s||(s=!0,window.Image=function(e,t){const r=new i(e,t);return new Proxy(r,{get(c,p,a){return Reflect.get(c,p,a)},set(c,p,a,I){return p=="src"&&n(a)?(c[p]="",!0):Reflect.set(c,p,a,I)}})})}class d{constructor(e){o(this,"interceptor");this.interceptor=e,this.setRequestHandler(),this.setResponseHandler()}setRequestHandler(){const{open:e}=XMLHttpRequest.prototype,t=this;XMLHttpRequest.prototype.open=function(r,u,c,p,a){t.interceptor.request(u),e.call(this,r,u,c,p,a)}}setResponseHandler(){const e=this;new PerformanceObserver(function(r){r.getEntries().forEach(u=>{["img","xmlhttprequest"].includes(u.initiatorType)&&e.interceptor.response(u.name)})}).observe({entryTypes:["resource"]})}}class h{constructor(){o(this,"list",[])}add(e){this.list.push(e)}delete(e){const t=this.list.findIndex(r=>r==e);t!=-1&&this.list.splice(t,1)}getLength(){return this.list.length}clear(){for(;this.list.length;)this.list.pop()}}function g(n){let e=document.querySelector("body")||document.createElement("div"),t={childList:!0,attributes:!0,subtree:!0};new MutationObserver(n).observe(e,t)}class f extends h{constructor(){super(),g(this.getCurrentImageResquest.bind(this))}getCurrentImageResquest(){Array.from(document.querySelectorAll("img[src]")).filter(t=>!t.complete).forEach(t=>{this.add(t.currentSrc),t.addEventListener("error",()=>{this.delete(t.currentSrc)})})}}class L extends h{constructor(t={}){super();o(this,"options");this.options=t}isLogger(t){const r=new RegExp(this.options.log||/.gif/);return typeof t!="string"?!1:!!r.test(t)}async requestLog(){const t=this.list.map(r=>new Promise(u=>{const c=new i;c.src=r,u(r)}));await Promise.all(t)}}function q(){return new f}function m(n){return new L(n)}class R{constructor(e,t){o(this,"requestList");o(this,"logList");this.requestList=e,this.logList=t}createRequestInterceptor(){const e=this;return function(t){return e.logList.isLogger(t)?(e.logList.add(t),!0):(e.requestList.add(t),!1)}}createResponseInterceptor(){const e=this;return function(t){if(!e.logList.isLogger(t))e.requestList.delete(t);else return!1;return e.requestList.getLength()==0&&e.logList.requestLog(),!0}}}class v{constructor(e){o(this,"options");o(this,"requestHandler");o(this,"requestList");o(this,"logList");o(this,"interceptor",{request:null,response:null});this.options=e,this.initRequestQueue(),this.initInterceptor(),this.initObserver()}initObserver(){l(this.interceptor.request),this.requestHandler=new d(this.interceptor)}initRequestQueue(){this.requestList=q(),this.logList=m(this.options)}initInterceptor(){const e=new R(this.requestList,this.logList);this.interceptor.request=e.createRequestInterceptor(),this.interceptor.response=e.createResponseInterceptor()}}return v});
//# sourceMappingURL=logScheduler.umd.cjs.map
